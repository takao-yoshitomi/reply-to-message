<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI返信文作成アシスタント</title>
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><img src="favicon.ico" alt="AI Icon" class="header-icon" id="infoIcon">文書作成アシスタント</h1>
            <!-- 説明文表示エリア -->
            <div id="infoModal" class="info-modal hidden">
                <div class="info-modal-content">
                    <span class="close-button">&times;</span>
                    <h2>利用方法</h2>
                    <p>このアプリケーションはAIのAPIを利用してメッセージの返信文や質問を生成します。</p>
                    <h3>返信モード</h3>
                    <ul>
                        <strong>①</strong>「更新」ボタンを押し利用できるAIを取り込みます<br>
                        <strong>②</strong> 使用モデルを選択します。<br>
                        【推奨】gemini-2.5-flash-シリーズ<br>
                        【推奨】gemini-2.0-flash-シリーズ<br>
                        【推奨】gemini-1.5-flash-シリーズ<br>
                        ※pro-シリーズは直ぐに無料枠が終わるので通常では非推奨です<br>
                        <br>
                        <strong>③</strong> モードを選択します（現在は返答モードのみ） <br>
                        <strong>④</strong> 受取ったメッセージを入力欄にコピペします。（音声入力も可）<br>
                        <strong>⑤</strong> 返答の設定を行います<br>
                        <strong>⑥</strong>「AIで変身を生成」をクリックします<br>
                        <strong>⑦</strong> 生成されたら内容を吟味し修正を行って下さい。<br>
                        <strong>⑧</strong> 生成した返信内容をコピペし返信します。<br>
                        <strong>⑨</strong> 過去の生成履歴を確認し、復元することもできます。<br>
                     </ul>    
                     <h3>質問モード（作成中）</h3>
                    
                    <h2>注意 ‼</h2>   
                        <li>専門的な税務や最新の法改正に関するご質問は、高度なAIモデルが提供されているサービスをご利用いただく方が確実な回答を得られます。このプロンプトをコピーして公式サイトをご活用下さい。</li> 
                        <li>AIが生成するURLは不確かなものが生じている可能性がありますので、もし添付等される時には必ずサイトをご確認下さい。</li>
                    </ul>
                    
                    <ul>
                        <strong></strong><br>
                        <strong></strong><br>
                        <strong></strong><br>
                        <strong></strong><br>
                        <strong></strong><br>
                    </ul>
                </div>
            </div>
        </header>
        <main>
            <section class="api-key-section">
                <div class="api-section-header">
                    <h2>API設定</h2>
                    <button id="toggleApiKeyVisibilityBtn">APIキーを編集</button>
                </div>
                <div id="apiKeySettingsArea" class="hidden">
                    <div class="setting-item">
                        <label for="apiKey">Gemini APIキー:</label>
                        <input type="password" id="apiKey" placeholder="ここにAPIキーを貼り付け">
                    </div>
                </div>
                <div class="setting-item">
                    <label for="modelSelector">使用モデル:</label>
                    <div class="model-selector-container">
                        <select id="modelSelector"></select>
                        <button type="button" id="updateModelsBtn">更新</button>
                    </div>
                </div>
            </section>

            <section class="mode-selection-section">
                <div class="tabs">
                    <button id="replyModeTab" class="tab-button active">返答モード</button>
                    <button id="questionModeTab" class="tab-button">質問モード（作成中）</button>
                    <button id="clearInputsBtn" title="入力内容をクリア">クリア</button>
                </div>
            </section>

            <div id="reply-mode-settings">
                <section class="input-section">
                    <h2>受け取ったメッセージ</h2>
                    <div class="textarea-with-button">
                        <textarea id="receivedMessage" placeholder="ここに相手からのメッセージを貼り付けてください..."></textarea>
                        <button type="button" id="mic-receivedMessage" class="mic-button" title="音声入力">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                                <path d="M8.25 4.5a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 .75.75v.75c0 1.11-.9 2.025-2.007 2.025-.978 0-1.79-.624-1.993-1.5H8.25v-.75Z" />
                                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM9.75 8.25a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-4.5ZM9 12a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5H9Zm-.75 3.75a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5h-7.5Z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </section>

                <section class="settings-section">
                    <h2>返答設定</h2>
                    <div class="setting-item">
                        <label for="userRole">あなたの役割:</label>
                        <input type="text" id="userRole" placeholder="例: ビジネスマン、友人、先生" value="税理士事務所職員">
                    </div>
                    <div class="setting-item">
                        <label>相手との関係性:</label>
                        <div class="radio-container">
                            <span class="radio-item"><input type="radio" id="rel_client" name="relationship" value="顧問先" checked><label for="rel_client">顧問先</label></span>
                            <span class="radio-item"><input type="radio" id="rel_supplier" name="relationship" value="取引先"><label for="rel_supplier">取引先</label></span>
                            <span class="radio-item"><input type="radio" id="rel_professional" name="relationship" value="士業"><label for="rel_professional">士業</label></span>
                            <span class="radio-item">
                                <input type="radio" id="rel_other" name="relationship" value="other">
                                <label for="rel_other_text">その他:</label>
                                <input type="text" id="rel_other_text" placeholder="自由入力">
                            </span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="sentiment">感情の方向性 (否定的 / 肯定的): <span id="sentimentValue">100</span></label>
                        <input type="range" id="sentiment" min="-100" max="100" value="100">
                    </div>
                    <div class="setting-item">
                        <label for="politeness">丁寧度: <span id="politenessValue">80</span></label>
                        <input type="range" id="politeness" min="0" max="100" value="80">
                    </div>
                    <div class="setting-item-row">
                        <div class="setting-item">
                            <label for="charCount">概算文字数:</label>
                            <input type="text" id="charCount" placeholder="例: 200-250">
                        </div>
                        <div class="setting-item">
                            <label>句読点:</label>
                            <div class="radio-container">
                                <span class="radio-item"><input type="radio" id="punc_yes" name="punctuation" value="あり" checked><label for="punc_yes">あり</label></span>
                                <span class="radio-item"><input type="radio" id="punc_no" name="punctuation" value="なし"><label for="punc_no">なし</label></span>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label>追加質問・引用サイトの表示:</label>
                            <div class="radio-container">
                                <span class="radio-item"><input type="radio" id="show_extra_yes" name="show_extra" value="あり" checked><label for="show_extra_yes">あり</label></span>
                                <span class="radio-item"><input type="radio" id="show_extra_no" name="show_extra" value="なし"><label for="show_extra_no">なし</label></span>
                            </div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="replyContent">返信に含めるべき内容:</label>
                        <div class="textarea-with-button">
                            <textarea id="replyContent" rows="3" placeholder="例: 次回の打ち合わせ日程の提案、箇条書きで、お会いする文言は入れない等"></textarea>
                            <button type="button" id="mic-replyContent" class="mic-button" title="音声入力">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                                    <path d="M8.25 4.5a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 .75.75v.75c0 1.11-.9 2.025-2.007 2.025-.978 0-1.79-.624-1.993-1.5H8.25v-.75Z" />
                                    <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM9.75 8.25a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-4.5ZM9 12a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5H9Zm-.75 3.75a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5h-7.5Z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <label>参照URL:</label>
                        <div id="urlContainer"></div>
                        <button type="button" id="addUrlBtn">URLを追加</button>
                    </div>
                </section>
            </div>

            <div id="question-mode-settings" class="hidden">
                <section class="input-section">
                    <h2>質問内容</h2>
                    <textarea id="questionContent" rows="4" placeholder="ここに質問したい内容を具体的に入力してください..."></textarea>
                </section>

                <section class="settings-section">
                    <h2>回答設定</h2>
                    <div class="setting-item">
                        <label for="expertise">専門分野:</label>
                        <input type="text" id="expertise" placeholder="例: IT、法律、医療、税務">
                    </div>
                    <div class="setting-item">
                        <label for="outputFormat">望ましい回答形式:</label>
                        <input type="text" id="outputFormat" placeholder="例:箇条書き、ステップバイステップ、表形式">
                    </div>
                    <div class="setting-item">
                        <label for="urgency">緊急度:</label>
                        <select id="urgency">
                            <option value="low">低</option>
                            <option value="medium" selected>中</option>
                            <option value="high">高</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="assumptions">前提情報・文脈:</label>
                        <textarea id="assumptions" rows="3" placeholder="この質問の背景となる情報や、AIが考慮すべき前提条件を記入してください。"></textarea>
                    </div>
                     <div class="setting-item">
                        <label>参照URL:</label>
                        <div id="urlContainerQuestion"></div>
                        <button type="button" id="addUrlBtnQuestion">URLを追加</button>
                    </div>
                </section>
            </div>

            <div class="action-area">
                <button id="generateBtn">AIで生成する</button>
                <div id="loader" class="loader" style="display: none;"></div>
            </div>

            <section class="output-section">
                <div class="output-header">
                    <h2>生成されたプロンプト</h2>
                    <div>
                        <button id="togglePromptBtn">プロンプトを表示</button>
                        <button id="copyPromptBtn">クリップボードにコピー</button>
                    </div>
                </div>
                <div id="promptDisplayArea" class="hidden">
                    <pre id="generatedPrompt">ここにプロンプトが表示されます...</pre>
                </div>
            </section>

            <section class="output-section ai-reply-section">
                <div class="output-header">
                    <h2>AIからの返信</h2>
                    <button id="copyReplyBtn">返信をコピー</button>
                </div>
                <div id="aiReply" class="ai-reply-box">ここにAIからの返信が表示されます...</div>
                <div id="additionalQuestionsArea" class="additional-questions-area hidden">
                    <h3>AIからの追加質問の提案</h3>
                    <ul id="additionalQuestionsList"></ul>
                </div>
            </section>

            <section class="history-section">
                <h2>生成履歴</h2>
                <div id="historyContainer">
                    <p>まだ履歴はありません。</p>
                </div>
            </section>
        </main>
        <footer>
            <p>&copy; 2025 Reply Generator</p>
        </footer>
    </div>
    <script src="script.js"></script>
</body>
</html>